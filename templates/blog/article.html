{% extends 'base.html' %}
{% load blog_tags %}
{% load static %}

{% block title %}{{ article.title }}{% endblock title %}

{% block content %}
<section class="blog-details spad">
    <div class="container">
        <div class="row d-flex justify-content-center">
            <div class="col-lg-8">
                <div class="blog__details__title">
                    <h6>{{ article.author }} <span>- {{ article.time_create }} </span>
                    {% if user.is_authenticated %}
                        {% if user.id == article.author.id %}
                        <a href="{% url 'update_article' article.slug %}"><span class="far fa-edit"></span></a>
                        <a href="{% url 'delete_article' article.slug %}"><span class="far fa-trash-alt"></span></a>
                        {% endif %}
                    {% endif %}
                    </h6>
                    <h2>{{ article.title }}</h2>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="blog__details__pic">
                    <img src="{{ article.photo.url }}" alt="">
                </div>
            </div>
            <div class="col-lg-8">
                <div class="blog__details__content">
                    <div class="blog__details__text">
                        <p>{{ article.content|safe|linebreaks }}</p>
                    </div>
                </div>
            </div>
        </div>
            {% if user.is_authenticated %}
                {% is_liked slug=article.slug user_id=user.id as is_user_likes %}
                {% total_likes slug=article.slug as total_article_likes %}
                <p>Эта статья понравилась {{ total_article_likes }} людям</p>
                {% if not is_user_likes %}
                    <form action="{% url 'add_like_article' article.slug %}" method="post">
                        {% csrf_token %}
                        <button type="submit" name="article_slug" value="{{ article.slug }}"
                                class="btn btn-primary btn-sm">like</button>
                    </form>
                {% else %}
                    <form action="{% url 'remove_like_article' article.slug %}" method="post">
                        {% csrf_token %}
                        <button type="submit" name="article_slug" value="{{ article.slug }}"
                                class="btn btn-danger btn-sm">Unlike</button>
                    </form>
                {% endif %}
            {% else %}
                <p>Войтите чтобы поставить лайк</p>
            {% endif %}

    </div>
</section>
{% endblock %}